var loadCreateJS=function(a){return Game.setting.isCjsRC?void require(["createjslite_rc"],function(b){window.createjs=b,require(["lib/createjslite-patch"],function(){a()})}):void(0===Game.setting.cjs_mode?require(["lib/createjs"],function(){require(["lib/createjs-patch","lib/soundjs-0.5.2-patch"],function(){a()})}):1===Game.setting.cjs_mode&&require(["createjsliteopengl"],function(b){window.createjs=b,require(["lib/createjslite-patch"],function(){a()})}))};new Promise(function(a){require(["lib/device_detector"],function(b){b().then(function(b){for(var c in b)Game.ua[c]=b[c];window.startDisplayInitialize(),require(["lib/common"],function(){a()})})})}).then(function(){if(require(["util/device"]),window.AndroidCacheProxy){window.AndroidCacheProxy.setCacheManifest=function(a,b,c){var d=window.localStorage.cy_last_time||0;window.localStorage.cy_last_time=Date.now();var e=window.localStorage.cy_cache_manifest||"";if(a!=e){var f=.001*d|0;AndroidCacheProxy.dispatch("updateCache,"+f+","+a),window.localStorage.cy_cache_manifest=a}else AndroidCacheProxy.dispatch("clearCache,"+b+","+c)};var a=window.localStorage.cache_size||0,b=window.localStorage.cache_retention||0;AndroidCacheProxy.setCacheManifest(Game.modifiedListUri,a,b)}if(loadCreateJS(function(){require(["lib/locallib"],function(){require(["jquery","underscore","util/ajax","lib/shellapp","lib/andapp"],function(a,b,c,d,e){function f(a,c,d){var e=new XMLHttpRequest;e.url="",e.onreadystatechange=function(){(e.readyState===XMLHttpRequest.prototype.DONE||e.readyState===XMLHttpRequest.prototype.UNSENT)&&d&&d(e)},e.open("POST",j.baseUri+"survey/status?_="+(new Date).getTime()),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var f=b.map({url:a,status:c,href:window.location.href},function(a,b){return b+"="+a}).join("&");e.send(f)}var g=function(){if(window.AndroidCacheProxy&&window.localCacheServerPort){var a={jpg:!0,jpeg:!0,png:!0,mp3:!0,mp4:!0,woff:!0,ogg:!0},c=function(b,c){var d=b.substring(b.lastIndexOf("/")+1),e=d.indexOf("?");-1!==e&&(d=d.substring(0,e));var f=d.indexOf("#");-1!==f&&(d=d.substring(0,f));var g=!1;if(c)g=!0;else{var h=d.substring(d.lastIndexOf(".")+1);g=a[h]===!0}return g?"http://localhost:"+window.localCacheServerPort+"/"+d+"?oriUri="+b:b},d=function(a){var b=document.createElement("img");b.crossOrigin="anonymous";var d=function(){b.removeEventListener("load",e),b.removeEventListener("error",f),b.src="",b=null},e=function(){var c=document.createElement("canvas"),e=c.getContext("2d");e.drawImage(b,0,0);try{e.getImageData(0,0,1,1)}catch(f){return void d()}a(),d()},f=function(){d()};b.addEventListener("load",e),b.addEventListener("error",f),b.src=c(window.Game.baseUri+"favicon.ico",!0)},e=function(){var a=window.createjs.LoadQueue.prototype,d=a.loadFile;a.loadFile=function(a,b,e){"string"==typeof a?a=c(a):"string"==typeof a.src&&(a.src=c(a.src)),d.call(this,a,b,e)};var e=a.loadManifest;a.loadManifest=function(a,d,f){b.isArray(a)&&b.each(a,function(a){"string"==typeof a.src&&(a.src=c(a.src))}),e.call(this,a,d,f)}},f=document.createElement("canvas"),g=f.getContext("webgl")||f.getContext("experimental-webgl");window.createjs.denaVersion&&g?d(e):e()}};if(g(),d.isShellApp()&&window.Game.ua.versionCompare(d.getVersionName(),"1.3.9")>0){var h=function(){function a(){window.mobage&&window.mobage.shellapp&&window.mobage.shellapp.ChangeLanguage&&window.mobage.shellapp.ChangeLanguage.exec(d)}function b(){window.mobage&&window.mobage.shellapp&&window.mobage.shellapp.ChangeLanguage&&window.mobage.shellapp.ChangeLanguage.exec(e+"ja"+f)}function c(){window.mobage&&window.mobage.shellapp&&window.mobage.shellapp.ChangeLanguage&&window.mobage.shellapp.ChangeLanguage.exec(e+"en"+f)}var d='{"command": "get_current_language", "callback_ok": "callbackOKLanguageV", "callback_ng": "callbackNGLanguageV"}',e='{"command": "set_language", "language": "',f='", "callback_ok": "callbackOKLanguage", "callback_ng": "callbackNGLanguageV"}';window.callbackOKLanguage=function(){},window.callbackNGLanguage=function(){},window.callbackOKLanguageV=function(a){},window.callbackNGLanguageV=function(a){},window.callbackOKLanguageV=function(a){if(window.Game.lang!=a)switch(window.Game.lang){case"ja":b();break;case"en":default:c()}},a()};h()}else window.Game.ua.isAndApp()===!0&&e.setGameSetting();d.isShellApp()&&d.sendAdjustId(window.Game.userId);var i=null,j=window.Game;j.ajaxConnecting=!1;var k=a(document);k.on("ajaxError",function(a,b,c){(409==b.status||410==b.status)&&(j.ajaxStatus=b.status,requirejs.onError=function(){},i=c.url)}),k.on("ajaxStart",function(){j.ajaxConnecting=!0}),k.on("ajaxStop",function(){j.ajaxConnecting=!1,409==j.ajaxStatus&&f(i,409,function(){alert(j.message.update),window.location.reload()}),410==j.ajaxStatus&&f(i,410,function(){alert(j.message.appUpdate),j.ua.isAndApp()===!0?e.appUpdate():d.openBrowser(d.getUpdateUrl())})}),a.ajaxSetup({beforeSend:function(a,b){if(b.url){var e=(new Date).getTime()+"&uid="+j.userId;b.url+=(b.url.indexOf("?")>=0?"&t=":"?t=")+e}if("GET"!==b.type&&c.controlXHR(a,b.url))return!1;if(j.shellAppFlag){a.setRequestHeader("X-MOBAGE-SHELLAPP",1);var f=d.getVersionName(),g=Number(d.getVersionCode());"1.0"===f&&g&&g>0&&(f+=".0."+g),a.setRequestHeader("X-MOBAGE-SHELLAPP-VERSION",f)}a.setRequestHeader("X-VERSION",j.version),(409==j.ajaxStatus||410==j.ajaxStatus)&&a.abort(),c.addXHR(a)},complete:function(a){c.removeXHR(a)}}),require(["backbone","view/loading","router/app-router","lib/underscore_mixin","lib/sound-player"],function(a,c,e,f,g){j.loading=new c,j.router=new e,d.isShellAppAndroid()&&(j.androidSound={mute:g.mute,unmute:g.unmute});var h=!!j.isSandbox&&!!j.isSandboxRouter;h||a.history.start(),j.submenu&&require(["submenu"]),b.isUndefined(j.footer)===!1&&require(["view/footer/index"],function(a){j.footer.mainView=new a})})})})}),Game.ua.isIOS()&&Game.ua.versionCompare(Game.ua.os.version,"13.4")>=0){var c=["createjs","lib","images","exportRoot","stage","Game","Backbone","ShellApp","jQuery","requirejs","require","$","_","loadingSoundPlayer","displayInitialize","requirejs_createNode","define","Pex","Zlib","auto_flag","deviceRatio","ignoreSkipAttackFrame","loadCreateJS","patchWithCJSScale","play_down_se","previousTime","readySoundPlayer","reportInterval","onerror","callbackOKLanguage","callbackNGLanguage","callbackOKLanguageV","callbackNGLanguageV","clientData","tmpAutoBtnDisplayFlg","attack_num","chain_num","arcarum_skip_num","arcarum_skip_akabako_array","arcarum_skip_plus_array","arcarum_skip_piece_array","canvPlayingStatus","stage_touch","stage_chance","ballArray","casino_effect_drop_plate_option","casino_effect_drop_voice","cards_1_Array","cards_2_Array","doubleUp_card_1","doubleUp_card_2","stage_effect","speedCount","pointNum","cjs_stage_awakening_lvup_result","cjs_exportRoot_awakening_lvup_result","awakening_lvup_result_text","awakening_lvup_result_text2","awakening_lvup_result_level","awakening_lvup_result_count","lb_classup_result_array","npcVoiceFlg","npcVoice","lb_exbonus_result_text","lb_exbonus_result_count","arcarum_result_clear_num","cjs_exportRoot_jobchange","cjs_stage_jobchange","playTownBGM_flg","today","dayArray","canvas","stampArray","missionObj","isNextMission","completeMsgArray","pressIndexArray","pNum","settledCount","uncap_character_star_gold","uncap_character_star_blue","uncap_character_star_before","uncap_character_star_after","uncap_character_max","uncap_character_lv1","uncap_character_lv2","uncap_character_is_after_lv_max","uncap_character_new_id","cjs_exportRoot_uncap_character_new","cjs_stage_uncap_character_new","uncap_equipment_star_gold","uncap_equipment_star_blue","uncap_equipment_star_before","uncap_equipment_star_after","uncap_equipment_max","uncap_equipment_lv1","uncap_equipment_lv2","uncap_equipment_is_after_lv_max","uncap_equipment_skill_view","uncap_equipment_skill1","uncap_equipment_skill2","timerId","npc_get_ticket_rare","npc_get_ticket_text1","npc_get_ticket_npc_id","npc_get_ticket_npc_text1","npc_get_ticket_attribute","onYouTubeIframeAPIReady","cjs","upgrade_equipment_type","upgrade_equipment_max","upgrade_equipment_lv1","upgrade_equipment_lv2","upgrade_equipment_is_after_lv_max","upgrade_equipment_skill_view","upgrade_equipment_skill1","upgrade_equipment_skill2","cjs_canvas_gacha","cjs_stage_npc_get_skin","cjs_exportRoot_npc_get_skin","starlegend_flg","cjs_stage_gacha","cjs_exportRoot_gacha","cjs_gacha_num","cjs_gacha_stone_count","cjs_gacha_demo_num","crystal_flg","gacha_type_array","gacha_rare_array","gacha_attribute_array","gacha_quality_array","gacha_text1","gacha_text2","gacha_text3","gacha_text4","npc_get_skin_text","npc_get_skin_npc_id","cjs_npc_get_skin_voice","gacha_npc_text","gacha_npc_id","gacha_moon_array","limited_gene_attribute","is_lupi_gacha","SCENE_RETURN_ID_STAGE","SCENE_RETURN_ID_RAID","SCENE_RETURN_ID_LIST","SCENE_RETURN_ID_REWARD","SCENE_RETURN_ID_GACHA","SCENE_RETURN_ID_ARCHIVE","SCENE_RETURN_ID_ISLAND_RELEASE","SCENE_RETURN_ID_MYPAGE","SCENE_RETURN_ID_EVENT","SCENE_RETURN_ID_DEBUG","SCENE_RETURN_ID_COOP_QUEST","SCENE_RETURN_ID_FATE","SCENE_RETURN_ID_ARCHAIC","SCENE_RETURN_ID_APRILFOOL","SCENE_RETURN_ID_SKY","SCENE_RETURN_ID_REWARD_NOT_FATE","SCENE_RETURN_ID_ARCARUM_STAGE","quest_map_clear_number","quest_map_select","quest_island_select_select","quest_island_select_text_array","quest_island_select_nummber_array","quest_island_select_island_array","quest_island_select_key_on","isAirSpaceSelectable","quest_island_select_arcarum","arcarum_map_stg_array","arcarum_map_line_array","arcarum_map_next_stg_flg","npc_get_voice","npc_get_text1","npc_get_text2","braveground_complete_master_num","braveground_complete_master_plus_array","braveground_complete_master_piece_array","teamraid_win_text","teamraid_lose_text","msgArray","hintArray","mystery_ok_first_flag","specialbattle_win_num","specialbattle_win_piece_array","gacha_item_flg_array","gacha_rareitem_flg_array","cjsCacheValue","cjsCacheRetention","elizabeth_get_text1","twttr","IScroll","LoadManager","lmlib","UAParser","has","cjs_stage_job_perfectionproof_result","cjs_exportRoot_job_perfectionproof_result","job_perfectionproof_result_text","job_perfectionproof_result_level","job_perfectionproof_result_count"];window.addEventListener("unload",function(){_.each(c,function(a){window[a]&&(window[a]=null)}),window.CanvasRenderingContext2D.prototype.drawImage=null})}});