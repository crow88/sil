define(["view/cjs","model/cjs-loader","model/manifest-loader"],function(a,b,c){var d=12,e=["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],f=a.extend({targetCanvas:null,initialize:function(a){this.on("xhrStart",Game.loading.xhrStart),this.on("xhrEnd",Game.loading.xhrEnd),window.cjs.canvas.scenePrivate=cjs.canvas.scenePrivate||null,window.cjs.stage.scenePrivate=cjs.stage.scenePrivate||null,window.cjs.exportRoot.scenePrivate=cjs.exportRoot.scenePrivate||null;var b=_.isNaN(+a.opacity)?1:+a.opacity;this.targetCanvas=a.isBgEffect?"cjs-bg-effect":"cjs-scene-effect",this.scene_id=a.scene_id,this.motion=a.motion||0,this.fpsNum=a.fpsNum||d,this.opacity=b,this.posX=this.getFixedPos(a.posX)||0,this.posY=this.getFixedPos(a.posY)||0,this.rotate=a.rotate||0,this.scaleX=a.scaleX||1,this.scaleY=a.scaleY||1,this.blendModeId=a.blendModeId||0,this.render()},render:function(){return null===cjs.stage.scenePrivate?this.cjsRender():null!=cjs.canvas.scenePrivate&&cjs.canvas.scenePrivate.id!=this.targetCanvas?(this.removeChildren(),this.cjsRender()):this.motionCall(),this},cjsRender:function(){Game.loading.xhrStart();var a=[];a.push(this.scene_id);var c=this;b.once("complete",function(){cjs.stage.scenePrivate&&c.removeEvent(),cjs.canvas.scenePrivate=document.getElementById(c.targetCanvas);var a=cjs.canvas.scenePrivate.style,b=document.getElementById(c.targetCanvas+"-container"),d=b.style;a.transform="translate("+c.posX+","+c.posY+") rotate("+c.rotate+"deg) scale("+c.scaleX+","+c.scaleY+")",d.mixBlendMode=e[c.blendModeId],cjs.exportRoot.scenePrivate=new lib[c.scene_id];var f=new createjs.Container;f.alpha=+c.opacity,f.addChild(cjs.exportRoot.scenePrivate),cjs.stage.scenePrivate=new createjs.Stage(cjs.canvas.scenePrivate),cjs.stage.scenePrivate.addChild(f),cjs.stage.scenePrivate.update(),createjs.Ticker.setFPS(c.fpsNum),createjs.Ticker.addEventListener("tick",cjs.stage.scenePrivate),Game.loading.xhrEnd(),c.motion&&c.motionCall()}),b.loadFiles(a,!0)},motionCall:function(){var a=this,b=a.motion.replace(/\'/g,"").replace(/\"/g,"");setTimeout(function(){cjs.exportRoot.scenePrivate[a.scene_id].gotoAndPlay(b)},5)},removeChildren:function(){cjs.stage.scenePrivate&&(createjs.Ticker.removeEventListener("tick",cjs.stage.scenePrivate),cjs.stage.scenePrivate.removeAllChildren(),cjs.stage.scenePrivate.clear(),cjs.stage.scenePrivate.update(),cjs.stage.scenePrivate=null)},getFirstChildOfStage:function(){var a=new $.Deferred,c=window.cjs,d=c&&c.stage&&c.stage.scenePrivate?c.stage.scenePrivate.getChildAt(0):null;return d?a.resolve(d):b.once("complete",function(){d=c.stage.scenePrivate.getChildAt(0),a.resolve(d)}),a.promise()},getFixedPos:function(a){return"string"==typeof a&&/^([-+])?\d+px$/.test(a)?parseInt(a,10)*Game.getZoom()+"px":a}});return f});